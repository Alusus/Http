import "Srl/Console.alusus";
import "Srl/String.alusus";
import "Srl/Memory.alusus";
import "Apm.alusus";
اشمل "مـتم/طـرفية.أسس"؛
اشمل "مـتم/نـص.أسس"؛
اشمل "مـتم/ذاكـرة.أسس"؛
اشمل "بننف.أسس"؛


عرف أخـتبار_الوحدة: لقب TestModule؛
@دمج وحدة أخـتبار_الوحدة {

    استخدم مـتم؛
    

    دالة ابدا(){


        عرف سياق: مؤشر[بـننف.سـياق] = بـننف.أنشئ_الخادم(طلب_المنادى~مؤشر, "8080")؛

         
         طـرفية.اطبع("it's working in port 8080: http://localhost:8080/\npress enter to close server: ");

        طـرفية.أدخل_محرفا()؛

        بـننف.اغلاق_الخادم(سياق)؛
    };



    دالة طلب_المنادى (اتصال: مؤشر[بـننف.اتـصال]): صحيح{

     عرف معلومات_الطلب: مؤشر[بـننف.مـعلومات_الطلب] = بـننف.هات_معلومات_الطلب(اتصال)؛ 


        عرف سياق: مصفوفة[محرف, 1024]؛


        نـص.عيّن(سياق~مؤشر, "<h1>Welcome from Alusus</h1><p> you are in \"%s\"", معلومات_الطلب~محتوى.معرف_محلي);

        بـننف.اطبع(اتصال, "HTTP/1.1 200 OK\r\n");

         بـننف.اطبع(اتصال,  "Content-Type: text/html\r\n");

        بـننف.اطبع(اتصال,  "Content-Length: %d\r\n\r\n", نـص.هات_الطول(سياق~مؤشر))؛

        بـننف.اطبع(اتصال, سياق~مؤشر)؛


        أرجع 1؛
    };
};



أخـتبار_الوحدة.ابدا()؛
